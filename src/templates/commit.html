<!DOCTYPE html>
<html lang="en">

<head>
    {% include "header_template.html" %}
    <title>Review Commit</title>
    
    <!-- Custom Stylesheet -->
    <link href="/static/plugins/trumbowyg/ui/trumbowyg.css" rel="stylesheet">
    <link href="/static/plugins/trumbowyg/plugins/colors/ui/trumbowyg.colors.css" rel="stylesheet">
    <link href="/static/css/commit_styling.css" rel="stylesheet">
    <link href="/static/css/commit_page.css" rel="stylesheet">

    <script src="/static/plugins/jquery/jquery.min.js"></script>
    <script src="/static/js/html_diff_utils.js"></script>
    <script src="/static/js/image_handling.js"></script>
    <script src="/static/js/api_service.js"></script>
    <script src="/static/js/field_edit_panel.js"></script>
    <script src="/static/js/shared_ui.js"></script>

</head>
{% include "layout_header.html" %}

<div class="main-container">
    <div class="container-fluid">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">Review Commit</h1>
            
            <div class="commit-meta">
                <div class="meta-item">
                    <div class="meta-icon">
                        <i class="fa fa-clock-o"></i>
                    </div>
                    <span>{{ commit.timestamp }}</span>
                </div>
                <div class="meta-item">
                    <div class="meta-icon">
                        <i class="fa fa-user"></i>
                    </div>
                    <span>{{ commit.user }}</span>
                </div>
                <div class="meta-item">
                    <div class="meta-icon">
                        <i class="fa fa-folder"></i>
                    </div>
                    <span>{{ commit.deck }}</span>
                </div>
            </div>
            
            {% if commit.rationale %}
            <div class="commit-rationale-box">
                <strong>Rationale:</strong> {{ commit.rationale }}
            </div>
            {% endif %}
            
            {% if commit.commit_info %}
            <div class="commit-info-box">
                {{ commit.commit_info | striptags }}
            </div>
            {% endif %}

            <div class="commit-summary">
                <div class="commit-summary-count">
                    Showing <strong id="notes-loaded-count">{{ notes_loaded }}</strong> of <strong id="notes-total-count">{{ notes_total }}</strong> notes
                </div>
            </div>
            
            {% if user and owned == true %}
            <div class="actions-toolbar" id="bulk-actions-section" data-commit-id="{{commit.id}}">
                <div class="actions-primary-row">
                    <!-- Global Actions -->
                    <div class="action-group global-group">
                        <span class="group-label">All Changes</span>
                        <div class="btn-group">
                            <a href="/ApproveCommit/{{commit.id}}" class="modern-btn btn-success global-action-btn" title="Merges ALL notes in this commit, including notes not yet loaded">
                                <i class="fa fa-check-circle"></i>
                                Accept All
                            </a>
                            <a href="/DenyCommit/{{commit.id}}" class="modern-btn btn-danger global-action-btn" title="Denies ALL notes in this commit, including notes not yet loaded">
                                <i class="fa fa-times-circle"></i>
                                Deny All
                            </a>
                        </div>
                    </div>

                    <div class="action-divider"></div>

                    <!-- Selection Actions -->
                    <div class="action-group selection-group">
                        <span class="group-label">Selected (<span id="selection-count">0</span>)</span>
                        <div class="btn-group">
                            <button type="button" class="modern-btn btn-success-outline" id="bulk-approve-btn" disabled title="Approve only selected notes">
                                <i class="fa fa-check"></i>
                                Accept
                                <span class="bulk-btn-spinner" aria-hidden="true"></span>
                            </button>
                            <button type="button" class="modern-btn btn-danger-outline" id="bulk-deny-btn" disabled title="Deny only selected notes">
                                <i class="fa fa-times"></i>
                                Deny
                                <span class="bulk-btn-spinner" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="actions-secondary-row">
                    <button type="button" class="text-action-btn" id="select-all-visible-btn">
                        <i class="fa fa-check-square-o"></i> Select All Visible
                    </button>
                    <button type="button" class="text-action-btn hidden" id="deselect-all-btn">
                        <i class="fa fa-square-o"></i> Deselect All
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <div id="notes-container"
         class="notes-container"
         data-total="{{ notes_total }}"
         data-loaded="{{ notes_loaded }}"
         data-next-offset="{% if notes_next_offset %}{{ notes_next_offset }}{% endif %}"
         data-page-limit="{{ notes_limit }}"
         data-commit-id="{{commit.id}}">
        {% include "partials/commit_notes.html" %}
    </div>

    <div id="load-more-container" class="load-more-container {% if not notes_next_offset %}hidden{% endif %}">
        <button id="load-more-btn" class="modern-btn btn-light">
            <span class="btn-label">Load more</span>
            <span class="load-more-btn-spinner" aria-hidden="true"></span>
        </button>
        <div id="load-more-status" class="load-more-status" role="status" aria-live="polite"></div>
    </div>
    </div>
</div>

    {% include "layout_footer.html" %}

    <script src="/static/plugins/trumbowyg/trumbowyg.min.js"></script>
    <script src="/static/plugins/trumbowyg/plugins/colors/trumbowyg.colors.js"></script>
    <script src="/static/js/commit_page.js"></script>
</body>
</html>